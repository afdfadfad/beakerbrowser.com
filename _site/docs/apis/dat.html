<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
      <title>Web APIs - DatArchive API</title>
    

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/font-awesome.css">
    <link rel="icon" href="/img/favicon.png">

    <!-- social woo woo -->

    
      <meta name="twitter:card" content="summary">
      <meta name="twitter:site" content="@BeakerBrowser">
      <meta name="twitter:creator" content="@BeakerBrowser">
      <meta name="og:title" content="DatArchive API">
      <meta name="og:description" content="">
      
    

    
        <style>body { --page-color: #0eb370; }</style>
      
  </head>

  <body class="layout doc">
    
      <div class="docs-breadcrumbs ">
  

  <div class="container">
    <a href="/docs/" class="toplevel-link breadcrumb">Documentation</a>

    
      <span class="breadcrumb">
        /
      </span>

      <div class="breadcrumb active dropdown-container toggleable-container">
        <span class="toplevel-link">Web APIs</span>
        <i class="fa fa-angle-down"></i>

        <div class="dropdown nav-list left toggleable">
          
            
              <a class="nav-item" href="/docs/tour">Tour</a>
            
          
            
              <a class="nav-item" href="/docs/how-beaker-works">How Beaker works</a>
            
          
            
              <a class="nav-item active" href="/docs/apis/">
                Web APIs
                <i class="fa fa-check"></i>
              </a>
            
          
            
              <a class="nav-item" href="/docs/guides">Guides</a>
            
          
            
              <a class="nav-item" href="/docs/faq">Help & FAQ</a>
            
          
        </div>
      </div>

      
        <span class="breadcrumb">
          /
        </span>

        <div class="breadcrumb active dropdown-container toggleable-container">
          <span class="toplevel-link">DatArchive API</span>
          <i class="fa fa-angle-down"></i>

          <div class="dropdown wide nav-list left toggleable">
            
              
                <a class="nav-item active" href="/docs/apis/dat">
                  DatArchive API

                  

                  <i class="fa fa-check"></i>
                </a>
              
            
              
                <a class="nav-item" href="/docs/apis/manifest">
                  dat.json site manifest

                  
                </a>
              
            
              
                <a class="nav-item" href="/docs/apis/experimental-datpeers">
                  datPeers API

                  
                    <i class="fa fa-flask"></i>
                  
                </a>
              
            
              
                <a class="nav-item" href="/docs/apis/experimental-library">
                  Library API

                  
                    <i class="fa fa-flask"></i>
                  
                </a>
              
            
              
                <a class="nav-item" href="/docs/apis/experimental-globalfetch">
                  globalFetch API

                  
                    <i class="fa fa-flask"></i>
                  
                </a>
              
            
              
                <a class="nav-item" href="/docs/apis/experimental-capturepage">
                  capturePage API

                  
                    <i class="fa fa-flask"></i>
                  
                </a>
              
            

            <div class="dropdown-footer">
              <a href="/docs/apis/">
                <span class="fa fa-arrow-left"></span>
                Back to Web APIs
              </a>
            </div>
          </div>
      
      </div>
    
  </div>
</div>
      <div class="title-bar">
  <div class="container">
    
      <a href="/docs/apis" class="section-title">
        Web APIs
      </a>
    

    <h1>
      DatArchive API
      
    </h1>

    
  </div>
</div>
    

    <main class="docs ">
      <div class="container content-container">
        
          



<nav class="docs-sidebar">
  <!--
  <ul class="pages">
    
      
        
        <li class="active">
      
        <a href="/docs/apis/dat">DatArchive API</a>
      </li>
    
      
        <li>
      
        <a href="/docs/apis/manifest">dat.json site manifest</a>
      </li>
    
      
        <li>
      
        <a href="/docs/apis/experimental-datpeers">datPeers API</a>
      </li>
    
      
        <li>
      
        <a href="/docs/apis/experimental-library">Library API</a>
      </li>
    
      
        <li>
      
        <a href="/docs/apis/experimental-globalfetch">globalFetch API</a>
      </li>
    
      
        <li>
      
        <a href="/docs/apis/experimental-capturepage">capturePage API</a>
      </li>
    
  </ul>
  -->

  
    <ul class="headings">
      
        
          <li class="subheading">
            <a class="anchor" href="#permissions" title="Permissions">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Permissions
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#read-permissions">
                    
                      Read permissions
                    
                  </a>
                </li>
              
                <li>
                  <a href="#write-permissions">
                    
                      Write permissions
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#disk-usage" title="Disk usage">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Disk usage
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#per-origin-quotas">
                    
                      Per-origin quotas
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#constructor" title="Constructor">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Constructor
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#datarchive">
                    
                      <code>DatArchive()</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#toplevel-methods" title="Top-level methods">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Top-level methods
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#datarchive-load">
                    
                      <code>DatArchive.load()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#datarchive-create">
                    
                      <code>DatArchive.create()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#datarchive-fork">
                    
                      <code>DatArchive.fork()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#datarchive-selectarchive">
                    
                      <code>DatArchive.selectArchive()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#datarchive-resolvename">
                    
                      <code>DatArchive.resolveName()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#datarchive-unlink">
                    
                      <code>DatArchive.unlink()</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#properties" title="Properties">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Properties
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#url">
                    
                      <code>url</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#methods" title="Methods">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Methods
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#getinfo">
                    
                      <code>getInfo()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#configure">
                    
                      <code>configure()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#stat">
                    
                      <code>stat()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#readfile">
                    
                      <code>readFile()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#readdir">
                    
                      <code>readdir()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#writefile">
                    
                      <code>writeFile()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#mkdir">
                    
                      <code>mkdir()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#unlink">
                    
                      <code>unlink()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#rmdir">
                    
                      <code>rmdir()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#copy">
                    
                      <code>copy()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#rename">
                    
                      <code>rename()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#history">
                    
                      <code>history()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#checkout">
                    
                      <code>checkout()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#download">
                    
                      <code>download()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#watch">
                    
                      <code>watch()</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#events" title="Events">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Events
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#event-network-changed">
                    
                      <code>network-changed</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#event-download">
                    
                      <code>download</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#event-upload">
                    
                      <code>upload</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#event-sync">
                    
                      <code>sync</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="subheading">
            <a class="anchor" href="#deprecated-methods" title="Deprecated methods">
              #
            </a>

            <span class="collapseable-btn">
              <i class="fa fa-caret-right"></i>
              Deprecated methods
            </span>

            <ul class="collapseable collapsed">
              
                <li>
                  <a href="#diff">
                    
                      <code>diff()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#commit">
                    
                      <code>commit()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#revert">
                    
                      <code>revert()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#createfileactivitystream">
                    
                      <code>createFileActivityStream()</code>
                    
                  </a>
                </li>
              
                <li>
                  <a href="#createnetworkactivitystream">
                    
                      <code>createNetworkActivityStream()</code>
                    
                  </a>
                </li>
              
            </ul>
          </li>
        
      
    </ul>
  
</nav>



          <div class="content">
            <!-- TODO
- Only apps served over `dat://` are able to access this API.
- <i class="fa fa-flask"></i> Indicates that this API is under development and subject to change.
-->

<p class="accent">
	The <code>DatArchive</code> API is Beaker's interface for reading and writing the Dat peer-to-peer filesystem. Websites and applications can use the <code>DatArchive</code> API to create, write, and read Dat archives.
</p>

<h2 id="permissions">Permissions</h2>

<h3 id="read-permissions">Read permissions</h3>

<p>By default, any <code class="highlighter-rouge">dat://</code> website or application can read other <code class="highlighter-rouge">dat://</code> pages
with HTML embeds, Ajax, or the <code class="highlighter-rouge">DatArchive</code> read interfaces.</p>

<h3 id="write-permissions">Write permissions</h3>

<p>By default, <code class="highlighter-rouge">dat://</code> pages are only granted write permission for other <code class="highlighter-rouge">dat://</code> pages that it created.</p>

<p>The user will be prompted to grant permission when a <code class="highlighter-rouge">dat://</code> page attempts to:</p>

<ol>
  <li>Create a new Dat archive</li>
  <li>Modify a <code class="highlighter-rouge">dat://</code> page that was created by a different <code class="highlighter-rouge">dat://</code> origin</li>
</ol>

<p>Additionally, the user must be the owner of a given Dat archive in order to
modify it.</p>

<h4 id="special-files">Special files</h4>

<p>The <a href="/docs/apis/manifest.html"><code class="highlighter-rouge">dat.json</code> file</a> is a special file that specifies
metadata and configuration. It cannot be written directly using the <code class="highlighter-rouge">DatArchive</code>
API.</p>

<h2 id="disk-usage">Disk usage</h2>

<p>How Beaker manages a Dat archive’s disk usage depends on whether the user owns
the Dat archive, has chosen to seed the archive’s files, or is simply visiting
and browsing the archive’s files.</p>

<p>If the user owns a given Dat archive or has chosen to seed its files, Beaker
keeps those files on the local disk. All other <code class="highlighter-rouge">dat://</code> websites, applications,
and files are kept on the local disk temporarily, and will be automatically
deleted.</p>

<p>Files that are temporarily cached after visiting a <code class="highlighter-rouge">dat://</code> page can also
be manually purged in the <a href="beaker://settings#dat-network-activity">Beaker settings page</a>.</p>

<h3 id="per-origin-quotas">Per-origin quotas</h3>

<p>By default, each <code class="highlighter-rouge">dat://</code> origin is limited to 100MB of storage. In the future,
this limit will be configurable by user action.</p>

<p>When the 100MB limit is reached, all writes attempted
with the <code class="highlighter-rouge">DatArchive</code> API will fail.</p>

<h2 id="constructor">Constructor</h2>

<h3 id="datarchive">
    <code>
      
        new DatArchive(url)
      
    </code>

    

    
  </h3>
<div><p>Create a Dat archive instance from an existing archive.</p>

<ul>
  <li><code class="highlighter-rouge">url</code> String. The URL of the archive to instantiate.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h2 id="top-level-methods">Top-level methods</h2>

<h3 id="datarchive-load">
    <code>
      
        DatArchive.load(url)
      
    </code>

    

    
  </h3>
<div><p>Create a Dat archive instance from an existing archive.
This has the same effect as using the constructor, but allows you to <code class="highlighter-rouge">await</code> until load is successful.</p>

<ul>
  <li><code class="highlighter-rouge">url</code> String. The URL of the archive to instantiate.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;DatArchive&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="datarchive-create">
    <code>
      
        DatArchive.create(opts?)
      
    </code>

    

    
  </h3>
<div><p>Create a new Dat archive, and return the archive instance.
The archive is sandboxed to only access to files within it.</p>

<ul>
  <li><code class="highlighter-rouge">opts.title</code> String. The title of the archive.</li>
  <li><code class="highlighter-rouge">opts.description</code> String. The description of the archive.</li>
  <li><code class="highlighter-rouge">opts.type</code> Array&lt;String&gt;. The archive’s type identifiers. <a href="manifest.html#type">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.links</code> Object. Top-level links to other resources. <a href="manifest.html#links">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.prompt</code> Boolean. Whether or not to show Beaker’s create archive modal. (If <code class="highlighter-rouge">false</code>, a simple permission prompt will be shown instead.)</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;DatArchive&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'My website'</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="s1">'A simple demo website'</span><span class="p">,</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="datarchive-fork">
    <code>
      
        DatArchive.fork(url, opts?)
      
    </code>

    

    
  </h3>
<div><p>Fork an existing archive to create a new Dat archive, and return the archive instance.
The archive is sandboxed to only access to files within it.</p>

<p>The fork will contain only the files in the target archive that have been completely downloaded.
Use <a href="#download"><code class="highlighter-rouge">download()</code></a> to ensure the intended files are ready.</p>

<ul>
  <li><code class="highlighter-rouge">url</code> String. The URL of the archive to fork.</li>
  <li><code class="highlighter-rouge">opts.title</code> String. The title of the archive.</li>
  <li><code class="highlighter-rouge">opts.description</code> String. The description of the archive.</li>
  <li><code class="highlighter-rouge">opts.type</code> Array&lt;String&gt;. The archive’s type identifiers. <a href="manifest.html#type">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.links</code> Object. Top-level links to other resources. <a href="manifest.html#links">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.prompt</code> Boolean. Whether or not to show Beaker’s fork modal. (If <code class="highlighter-rouge">false</code>, a simple permission prompt will be shown instead.)</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;DatArchive&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">fork</span><span class="p">(</span><span class="nx">otherURL</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Hello, world 2!'</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="s1">'My new fork'</span><span class="p">,</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="datarchive-unlink">
    <code>
      
        DatArchive.unlink(url)
      
    </code>

    

    
  </h3>
<div><p>Delete the given Dat archive from the user’s Library. The user must
grant permission to delete the archive.</p>

<ul>
  <li><code class="highlighter-rouge">url</code> String. The URL of the archive to delete.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="datarchive-selectarchive">
    <code>
      
        DatArchive.selectArchive(opts?)
      
    </code>

    

    
  </h3>
<div><p>Prompt the user to select a Dat archive from the Library or create a new
Dat archive, and return the archive instance.</p>

<ul>
  <li><code class="highlighter-rouge">opts.title</code> String. The title of the select archive modal.</li>
  <li><code class="highlighter-rouge">opts.buttonLabel</code> String. The label on the primary action button in the select archive modal.</li>
  <li><code class="highlighter-rouge">opts.filters.isOwner</code> Boolean. If true, only show archives that the user owns and can modify.</li>
  <li><code class="highlighter-rouge">opts.filters.type</code> String or Array&lt;String&gt;. If set, only show archives that have the given <code class="highlighter-rouge">type</code> strings in their dat.json. See <a href="manifest.html#type">dat.json site manifest</a> for more information.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;DatArchive&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">selectArchive</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Select an archive to use as your user profile'</span><span class="p">,</span>
  <span class="na">buttonLabel</span><span class="p">:</span> <span class="s1">'Select profile'</span><span class="p">,</span>
  <span class="na">filters</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">isOwner</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'user-profile'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="datarchive-resolvename">
    <code>
      
        DatArchive.resolveName(url)
      
    </code>

    

    
  </h3>
<div><p>Resolves a Dat shortname to its “raw” public-key URL.
See <a href="https://www.datprotocol.com/deps/0005-dns/">DEP-0005 DNS</a> for more information.</p>

<ul>
  <li><code class="highlighter-rouge">url</code> String. The URL of the archive to resolve.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;string&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">rawDatUrl</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">DatArchive</span><span class="p">.</span><span class="nx">resolveName</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h2 id="properties">Properties</h2>

<h3 id="url">
    <code>
      
        url
      
    </code>

    

    
  </h3>
<div><p>The URL of the archive.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">archive</span><span class="p">.</span><span class="nx">url</span>
</code></pre>
</div>
</div>

<h2 id="methods">Methods</h2>

<h3 id="getinfo">
    <code>
      
        getInfo(opts?)
      
    </code>

    

    
  </h3>
<div><p>Fetches information about the archive.</p>

<ul>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;Object&gt;</code></li>
</ul>

<p>Return object:</p>

<pre><code class="language-plain">{
  key: string (the archive public key)
  url: string (the archive URL)
  isOwner: boolean (is the user the owner of this archive?)

  version: number (the archive's current revision number)
  peers: number (the number of active connections for the archive)
  mtime: number (the walltime of the last received update; is reliable)
  size: number (bytes, the size-on-disk of the archive)

  title: string (the archive title)
  description: string (the archive description)
  type: array of strings (the archive's type identifiers)
  links: object (top-level links to other resources)
}
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">()</span>
</code></pre>
</div>
</div>

<h3 id="configure">
    <code>
      
        configure(opts)
      
    </code>

    

    
  </h3>
<div><p>Configure the dat.json manifest file values for the given Dat archive.</p>

<ul>
  <li><code class="highlighter-rouge">opts.title</code> String. The title of the archive.</li>
  <li><code class="highlighter-rouge">opts.description</code> String. The description of the archive.</li>
  <li><code class="highlighter-rouge">opts.type</code> Array&lt;String&gt;. The archive’s type identifiers. <a href="manifest.html#type">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.links</code> Object. Top-level links to other resources. <a href="manifest.html#links">Learn more</a>.</li>
  <li><code class="highlighter-rouge">opts.web_root</code> String. Path of the folder from which all web requests should be served.</li>
  <li><code class="highlighter-rouge">opts.fallback_page</code> String. Path to a fallback page to serve instead of the default 404 page.</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span><span class="na">title</span><span class="p">:</span> <span class="s1">'New title'</span><span class="p">,</span> <span class="na">fallback_page</span><span class="p">:</span> <span class="s1">'index.html'</span><span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="stat">
    <code>
      
        stat(path, opts?)
      
    </code>

    

    
  </h3>
<div><p>Fetches information about the file or directory at <code class="highlighter-rouge">path</code>.
The promise will reject if no file or directory is found.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the file/directory to stat.</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;Object&gt;</code></li>
</ul>

<p>Return object:</p>

<pre><code class="language-plain">Stat {
  isDirectory(): boolean
  isFile(): boolean

  // files only:
  size: number (bytes)
  blocks: number (number of data blocks in the metadata)
  downloaded: number (number of blocks downloaded, if a remote archive)
  mtime: Date (last modified time; not reliable)
  ctime: Date (creation time; not reliable)
}
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="s1">'/hello.txt'</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="timestamps">Timestamps</h4>

<p>The accuracy of timestamps (<code class="highlighter-rouge">mtime</code> and <code class="highlighter-rouge">ctime</code>) in <code class="highlighter-rouge">stat()</code> metadata is not guaranteed.
The <code class="highlighter-rouge">mtime</code> or <code class="highlighter-rouge">ctime</code> could be incorrect for the following reasons:</p>

<ul>
  <li>The author’s clock is misconfigured</li>
  <li>The author intentionally set an incorrect time</li>
</ul>
</div>

<h3 id="readfile">
    <code>
      
        readFile(path, opts?)
      
    </code>

    

    
  </h3>
<div><p>Reads the file’s contents.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the file to read.</li>
  <li><code class="highlighter-rouge">opts.encoding</code>
    <ul>
      <li><code class="highlighter-rouge">'utf8'</code> / <code class="highlighter-rouge">'utf-8'</code> (default) Return value will be a string.</li>
      <li><code class="highlighter-rouge">'base64'</code> Return value will be a string.</li>
      <li><code class="highlighter-rouge">'hex'</code> Return value will be a string.</li>
      <li><code class="highlighter-rouge">'binary'</code> Return value will be an ArrayBuffer.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;string|ArrayBuffer&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'/picture.png'</span><span class="p">,</span> <span class="s1">'binary'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">buf</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'image/png'</span><span class="p">})</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'img'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'/picture.png'</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'img'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'data:image/png;base64,'</span><span class="o">+</span><span class="nx">str</span>
</code></pre>
</div>
</div>

<h3 id="readdir">
    <code>
      
        readdir(path, opts?)
      
    </code>

    

    
  </h3>
<div><p>Reads the contents of a directory.
Returns an array listing the files and folders in the directory, excluding <code class="highlighter-rouge">'.'</code> and <code class="highlighter-rouge">'..'</code>.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the directory to read.</li>
  <li><code class="highlighter-rouge">opts.recursive</code> Boolean. Recurse the listing into the subdirectories?</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li><code class="highlighter-rouge">opts.stat</code> Boolean. Run stat() on every entry and return with <code class="highlighter-rouge"><span class="p">{</span><span class="err">name:,</span><span class="w"> </span><span class="err">stat:</span><span class="p">}</span></code></li>
  <li>returns <code class="highlighter-rouge">Promise&lt;Array&lt;String&gt;&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">topFiles</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">allFiles</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
<span class="kd">var</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span><span class="na">stat</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="writefile">
    <code>
      
        writeFile(path, data, opts?)
      
    </code>

    

    
  </h3>
<div><p>Writes <code class="highlighter-rouge">data</code> to the the file at <code class="highlighter-rouge">path</code>.
The promise will reject if there is already a directory at <code class="highlighter-rouge">path</code>, or if
the containing directory-tree does not yet exist.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the file to write.</li>
  <li><code class="highlighter-rouge">data</code> The data to be written.</li>
  <li><code class="highlighter-rouge">opts.encoding</code>
    <ul>
      <li><code class="highlighter-rouge">'utf8'</code> / <code class="highlighter-rouge">'utf-8'</code> Data must be a string. (This is the default value if data is a string.)</li>
      <li><code class="highlighter-rouge">'base64'</code> Data must be a string.</li>
      <li><code class="highlighter-rouge">'hex'</code> Data must be a string.</li>
      <li><code class="highlighter-rouge">'binary'</code> Data must be an ArrayBuffer. (This is the default value if data is an ArrayBuffer.)</li>
      <li>If <code class="highlighter-rouge">opts</code> is a string, it is specifying the encoding.</li>
    </ul>
  </li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="s1">'/hello.txt'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="mkdir">
    <code>
      
        mkdir(path)
      
    </code>

    

    
  </h3>
<div><p>Creates a new directory at <code class="highlighter-rouge">path</code>. The promise will reject if there is
already a file or directory at <code class="highlighter-rouge">path</code>, or if the containing directory-tree
does not exist.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the directory to create.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="s1">'/subdir'</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="unlink">
    <code>
      
        unlink(path)
      
    </code>

    

    
  </h3>
<div><p>Deletes the file at <code class="highlighter-rouge">path</code>. The promise will reject if no file is found,
or if the target path is a directory.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the file to delete.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">unlink</span><span class="p">(</span><span class="s1">'/hello.txt'</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="rmdir">
    <code>
      
        rmdir(path, opts?)
      
    </code>

    

    
  </h3>
<div><p>Deletes the directory at <code class="highlighter-rouge">path</code>.
The promise will reject if there is not a directory at <code class="highlighter-rouge">path</code>, or if the directory is not empty.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the directory to delete.</li>
  <li><code class="highlighter-rouge">opts.recursive</code> Boolean. If not empty, delete all files and folders inside the folder?</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">rmdir</span><span class="p">(</span><span class="s1">'/subdir'</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">rmdir</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="copy">
    <code>
      
        copy(path, dstPath, opts?)
      
    </code>

    

    
  </h3>
<div><p>Copies a file or directory to a target path.</p>

<ul>
  <li><code class="highlighter-rouge">path</code> The path of the file/directory to copy</li>
  <li><code class="highlighter-rouge">dstpath</code> The target path</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="s1">'/images'</span><span class="p">,</span> <span class="s1">'/backup-images'</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="rename">
    <code>
      
        rename(oldPath, newPath, opts?)
      
    </code>

    

    
  </h3>
<div><ul>
  <li><code class="highlighter-rouge">oldPath</code> The path to the file/directory be renamed</li>
  <li><code class="highlighter-rouge">newPath</code> The new path for the file/directory to be renamed</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="s1">'index.js'</span><span class="p">,</span> <span class="s1">'main.js'</span><span class="p">)</span>
</code></pre>
</div>
</div>

<h3 id="history">
    <code>
      
        history(opts?)
      
    </code>

    

    
  </h3>
<div><p>Fetch the history of changes to this archive.</p>

<ul>
  <li><code class="highlighter-rouge">opts.start</code> Number. Where in the history to start reading.</li>
  <li><code class="highlighter-rouge">opts.end</code> Number. Where in the history to stop reading.</li>
  <li><code class="highlighter-rouge">opts.reverse</code> Boolean. Reverse the order given?</li>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;Array&lt;Object&gt;&gt;</code></li>
</ul>

<p>Returns an array of objects:</p>

<pre><code class="language-plain">[
  {
    path: string (the path of the entry, eg '/index.html')
    version: number (the revision number that represents the change)
    type: string (the operation, 'put' or 'del')
  },
  ...
]
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">history</span><span class="p">({</span><span class="na">start</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">end</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="na">reverse</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="checkout">
    <code>
      
        checkout(version)
      
    </code>

    

    
  </h3>
<div><p>Checkout the a historic version of the archive.
All reads will be from that version.
(Writes will not be allowed.)</p>

<ul>
  <li><code class="highlighter-rouge">version</code> Number. Which revision to checkout.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">archiveOldVersion</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">checkout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// check out revision 10</span>
</code></pre>
</div>
</div>

<h3 id="download">
    <code>
      
        download(path, opts?)
      
    </code>

    

    
  </h3>
<div><p>Download the given file or folder, and return when finished.</p>

<ul>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;void&gt;</code></li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">download</span><span class="p">(</span><span class="s1">'/foo.txt'</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">download</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span> <span class="c1">// download the entire archive</span>
</code></pre>
</div>
</div>

<h3 id="watch">
    <code>
      
        watch(pattern?, onInvalidated?)
      
    </code>

    

    
  </h3>
<div><p>Watch the given path or path-pattern for file events.</p>

<ul>
  <li><code class="highlighter-rouge">pattern</code>
    <ul>
      <li>If a string, the path to watch. You can pass a falsy value to watch all.</li>
      <li>If an array of strings, an <a href="https://npm.im/anymatch">anymatch</a> pattern of paths to watch.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">onInvalidated</code> Function. An event callback which is automatically added to the ‘invalidated’ event.</li>
</ul>

<p>Provides an <code class="highlighter-rouge">EventTarget</code> with a <code class="highlighter-rouge">.close()</code> method and the following events:</p>

<ul>
  <li><code class="highlighter-rouge">'invalidated' ({path: string})</code> The contents of the file has changed, but may not have been downloaded yet.
    <ul>
      <li><code class="highlighter-rouge">path</code> is the path-string of the file.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'changed' ({path: string})</code> The contents of the file has changed, and the new version is ready to read.
    <ul>
      <li><code class="highlighter-rouge">path</code> is the path-string of the file.</li>
    </ul>
  </li>
</ul>

<p>A locally-owned archive will emit ‘invalidated’ and ‘changed’ when a write occurs. A remote archive will emit ‘invalidated’ first, then emit ‘changed’ when the new version has downloaded.</p>

<p>Examples:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">watch</span><span class="p">()</span> <span class="c1">// or...</span>
<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">'foo.txt'</span><span class="p">)</span> <span class="c1">// or...</span>
<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">watch</span><span class="p">([</span><span class="s1">'**/*.txt'</span><span class="p">,</span> <span class="s1">'**/*.md'</span><span class="p">])</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'invalidated'</span><span class="p">,</span> <span class="p">({</span><span class="nx">path</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'has been invalidated, downloading the update'</span><span class="p">)</span>
  <span class="nx">archive</span><span class="p">.</span><span class="nx">download</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'changed'</span><span class="p">,</span> <span class="p">({</span><span class="nx">path</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'has been updated!'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// later:</span>
<span class="nx">evts</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</code></pre>
</div>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">({</span><span class="nx">path</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'has been invalidated'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h2 id="events">Events</h2>

<h3 id="event-network-changed">
    <code>
      
        Event: "network-changed"
      
    </code>

    

    
  </h3>
<div><p>The network conditions have changed (e.g. a new peer has connected).</p>

<ul>
  <li><code class="highlighter-rouge">event.peers</code> Number. The number of active connections.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">archive</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'network-changed'</span><span class="p">,</span> <span class="p">({</span><span class="nx">peers</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">peers</span><span class="p">,</span> <span class="s1">'current peers'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="event-download">
    <code>
      
        Event: "download"
      
    </code>

    

    
  </h3>
<div><p>A data block has been downloaded.</p>

<ul>
  <li><code class="highlighter-rouge">event.feed</code> String. The data-feed which the block was a part of. Will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
  <li><code class="highlighter-rouge">event.block</code> Number. The index of data-block downloaded.</li>
  <li><code class="highlighter-rouge">event.bytes</code> Number. The number of bytes in the block.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">archive</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'download'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">,</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Downloaded a block in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">,</span> <span class="p">{</span><span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="event-upload">
    <code>
      
        Event: "upload"
      
    </code>

    

    
  </h3>
<div><p>A data block has been uploaded.</p>

<ul>
  <li><code class="highlighter-rouge">event.feed</code> String. The data-feed which the block was a part of. Will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
  <li><code class="highlighter-rouge">event.block</code> Number. The index of data-block uploaded.</li>
  <li><code class="highlighter-rouge">event.bytes</code> Number. The number of bytes in the block.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">archive</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'upload'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">,</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Uploaded a block in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">,</span> <span class="p">{</span><span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h3 id="event-sync">
    <code>
      
        Event: "sync"
      
    </code>

    

    
  </h3>
<div><p>All known data blocks have been downloaded.</p>

<ul>
  <li><code class="highlighter-rouge">event.feed</code> String. The data-feed which has been synced. Will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">archive</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'sync'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Downloaded everything currently published in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
</div>
</div>

<h2 id="deprecated-methods">Deprecated methods</h2>

<h3 id="diff">
    <code>
      
        diff(opts?)
      
    </code>

    

    
      <div class="badge error">Deprecated</div>
    
  </h3>
<div><p>Compare the current staging area to the published archive, and provide a list of the differences.</p>

<ul>
  <li><code class="highlighter-rouge">opts.timeout</code> Number. How long, in ms, to wait for a response? Default 5000.</li>
  <li><code class="highlighter-rouge">opts.shallow</code> Boolean. If true, diff() will not recurse into folders that need to be added or removed.</li>
  <li>returns <code class="highlighter-rouge">Promise&lt;Array&lt;Object&gt;&gt;</code></li>
</ul>

<p>Returns an array of objects:</p>

<pre><code class="language-plain">[
  {
    change: string (the operation, 'add' or 'mod' or 'del')
    type: string (the typeof of entry, 'dir' or 'file')
    path: string (path of the file)
  },
  ...
]
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">diff</span><span class="p">()</span>
</code></pre>
</div>
</div>

<h3 id="commit">
    <code>
      
        commit()
      
    </code>

    

    
      <div class="badge error">Deprecated</div>
    
  </h3>
<div><p>Publish all changes in the staging area to the archive, and provide a list of the applied changes.</p>

<ul>
  <li>returns <code class="highlighter-rouge">Promise&lt;Array&lt;Object&gt;&gt;</code></li>
</ul>

<p>Returns an array of objects:</p>

<pre><code class="language-plain">[
  {
    change: string (the operation, 'add' or 'mod' or 'del')
    type: string (the typeof of entry, 'dir' or 'file')
    path: string (path of the file)
  },
  ...
]
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">commit</span><span class="p">()</span>
</code></pre>
</div>
</div>

<h3 id="revert">
    <code>
      
        revert()
      
    </code>

    

    
      <div class="badge error">Deprecated</div>
    
  </h3>
<div><p>Undo all changes in the staging area, and provide a list of the reversions.</p>

<ul>
  <li>returns <code class="highlighter-rouge">Promise&lt;Array&lt;Object&gt;&gt;</code></li>
</ul>

<p>Returns an array of objects:</p>

<pre><code class="language-plain">[
  {
    change: string (the operation, 'add' or 'mod' or 'del')
    type: string (the typeof of entry, 'dir' or 'file')
    path: string (path of the file)
  },
  ...
]
</code></pre>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">revert</span><span class="p">()</span>
</code></pre>
</div>
</div>

<h3 id="createfileactivitystream">
    <code>
      
        createFileActivityStream(pattern?)
      
    </code>

    

    
      <div class="badge error">Deprecated</div>
    
  </h3>
<div><p><strong>Deprecated</strong>. Use <a href="#watch">watch()</a> instead.</p>

<p>Watch the given path or path-pattern for file events.</p>

<ul>
  <li><code class="highlighter-rouge">pattern</code>
    <ul>
      <li>If a string, the path to watch.</li>
      <li>If an array of strings, an <a href="https://npm.im/anymatch">anymatch</a> pattern of paths to watch.</li>
    </ul>
  </li>
</ul>

<p>Provides an <code class="highlighter-rouge">EventTarget</code> with a <code class="highlighter-rouge">.close()</code> method and the following events:</p>

<ul>
  <li><code class="highlighter-rouge">'changed' ({path: string})</code> The contents of the file has changed, either by a local write or a remote write. The new content will be ready when this event is emitted.
    <ul>
      <li><code class="highlighter-rouge">path</code> is the path-string of the file.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'invalidated' ({path: string})</code> The contents of the file has changed remotely, but it hasn’t been downloaded yet.
    <ul>
      <li><code class="highlighter-rouge">path</code> is the path-string of the file.</li>
    </ul>
  </li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">createFileActivityStream</span><span class="p">()</span> <span class="c1">// or...</span>
<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">createFileActivityStream</span><span class="p">(</span><span class="s1">'foo.txt'</span><span class="p">)</span> <span class="c1">// or...</span>
<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">createFileActivityStream</span><span class="p">([</span><span class="s1">'**/*.txt'</span><span class="p">,</span> <span class="s1">'**/*.md'</span><span class="p">])</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'invalidated'</span><span class="p">,</span> <span class="p">({</span><span class="nx">path</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'has been invalidated, downloading the update'</span><span class="p">)</span>
  <span class="nx">archive</span><span class="p">.</span><span class="nx">download</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'changed'</span><span class="p">,</span> <span class="p">({</span><span class="nx">path</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">'has been updated!'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// later:</span>
<span class="nx">evts</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</code></pre>
</div>
</div>

<h3 id="createnetworkactivitystream">
    <code>
      
        createNetworkActivityStream()
      
    </code>

    

    
      <div class="badge error">Deprecated</div>
    
  </h3>
<div><p><strong>Deprecated</strong>. You can now listen for these events on the <code class="highlighter-rouge">archive</code> object.</p>

<p>Watch for network events. Provides an <code class="highlighter-rouge">EventTarget</code> with a <code class="highlighter-rouge">.close()</code> method and the following events:</p>

<ul>
  <li><code class="highlighter-rouge">'network-changed' ({peers})</code> The number of connections has changed.
    <ul>
      <li><code class="highlighter-rouge">peers</code> is a number.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'download' ({feed,block,bytes})</code> A block has been downloaded.
    <ul>
      <li><code class="highlighter-rouge">feed</code> will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
      <li><code class="highlighter-rouge">block</code> is the index of data downloaded.</li>
      <li><code class="highlighter-rouge">bytes</code> is the number of bytes in the block.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'upload' ({feed,block,bytes})</code> A block has been uploaded.
    <ul>
      <li><code class="highlighter-rouge">feed</code> will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
      <li><code class="highlighter-rouge">block</code> is the index of data downloaded.</li>
      <li><code class="highlighter-rouge">bytes</code> is the number of bytes in the block.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">'sync' ({feed})</code> All known blocks have been downloaded.
    <ul>
      <li><code class="highlighter-rouge">feed</code> will either be <code class="highlighter-rouge">"metadata"</code> or <code class="highlighter-rouge">"content"</code>.</li>
    </ul>
  </li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">archive</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatArchive</span><span class="p">(</span><span class="nx">datUrl</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">archive</span><span class="p">.</span><span class="nx">createNetworkActivityStream</span><span class="p">()</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'network-changed'</span><span class="p">,</span> <span class="p">({</span><span class="nx">peers</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">peers</span><span class="p">,</span> <span class="s1">'current peers'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'download'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">,</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Downloaded a block in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">,</span> <span class="p">{</span><span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span>
<span class="p">})</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'upload'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">,</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Uploaded a block in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">,</span> <span class="p">{</span><span class="nx">block</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">})</span>
<span class="p">})</span>

<span class="nx">evts</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'sync'</span><span class="p">,</span> <span class="p">({</span><span class="nx">feed</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Downloaded everything currently published in the'</span><span class="p">,</span> <span class="nx">feed</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// later:</span>
<span class="nx">evts</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</code></pre>
</div>
</div>


          </div>
        
      </div>
    </main>

    <script>
    var $ = document.querySelector.bind(document)
    var $$ = function (selector) {
      return Array.prototype.slice.call(document.querySelectorAll(selector))
    }
    </script>
    <script src="/js/adjust-anchor-scroll-positioning.js"></script>
    <script src="/js/anchor.min.js"></script>
    <script>
    anchors.add('h2, h3, h4')
    </script>

    <script>
    [].forEach.call(document.querySelectorAll('img[data-src]'), function(img) {
      img.setAttribute('src', img.getAttribute('data-src'))
      img.onload = function() {
        img.removeAttribute('data-src')
      }
    })
    </script>
    <script>window.sa_event=window.sa_event||function(){a=[].slice.call(arguments);sa_event.q?sa_event.q.push(a):sa_event.q=[a]};</script>
<script async defer src="https://sa.beakerbrowser.com/latest.js"></script>
<noscript><img src="https://sa.beakerbrowser.com/noscript.gif" alt=""></noscript>
  </body>

  <script src="/js/toggleable.js"></script>
  <script src="/js/collapseable.js"></script>
</html>
